<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aztec B.O.S â€” Technical Architecture</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  
  <style>
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    html {
      scroll-behavior: smooth;
      -webkit-font-smoothing: antialiased;
    }
    
    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: #000;
      color: #fff;
      line-height: 1.6;
      overflow-x: hidden;
    }
    
    :root {
      --color-bg: #000000;
      --color-bg-card: rgba(255, 255, 255, 0.02);
      --color-cyan: #06B6D4;
      --color-cyan-glow: rgba(6, 182, 212, 0.3);
      --color-gold: #C9A962;
      --color-gold-glow: rgba(201, 169, 98, 0.3);
      --color-green: #10B981;
      --color-red: #EF4444;
      --color-purple: #8B5CF6;
      --color-text-primary: rgba(255, 255, 255, 0.9);
      --color-text-secondary: rgba(255, 255, 255, 0.6);
      --color-text-muted: rgba(255, 255, 255, 0.3);
      --color-border: rgba(255, 255, 255, 0.1);
      --font-mono: 'JetBrains Mono', monospace;
      --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 2rem;
    }
    
    .section {
      min-height: 100vh;
      padding: 6rem 0;
      position: relative;
    }
    
    .mono { font-family: var(--font-mono); }
    .text-cyan { color: var(--color-cyan); }
    .text-gold { color: var(--color-gold); }
    .text-green { color: var(--color-green); }
    .text-red { color: var(--color-red); }
    .text-purple { color: var(--color-purple); }
    
    /* Animation initial states */
    .fade-up {
      opacity: 0;
      transform: translateY(40px);
    }
    
    /* Backgrounds */
    .dot-grid {
      background-image: radial-gradient(circle, rgba(255,255,255,0.03) 1px, transparent 1px);
      background-size: 32px 32px;
    }
    
    .line-grid {
      background-image: 
        linear-gradient(rgba(6, 182, 212, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(6, 182, 212, 0.03) 1px, transparent 1px);
      background-size: 60px 60px;
    }
    
    /* Grain overlay */
    .grain {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9999;
      opacity: 0.03;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
    }
    
    /* Section labels */
    .section-label {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .label-line {
      width: 48px;
      height: 1px;
      background: linear-gradient(90deg, var(--color-cyan), transparent);
    }
    
    .label {
      font-family: var(--font-mono);
      font-size: 0.625rem;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      color: var(--color-text-muted);
    }
    
    /* Typography */
    h1 {
      font-size: clamp(3rem, 10vw, 6rem);
      font-weight: 700;
      letter-spacing: -0.03em;
      line-height: 0.95;
      margin-bottom: 1.5rem;
    }
    
    h2 {
      font-size: clamp(2rem, 5vw, 3rem);
      font-weight: 700;
      letter-spacing: -0.02em;
      line-height: 1;
      margin-bottom: 2rem;
    }
    
    h3 {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--color-cyan);
    }
    
    p {
      color: var(--color-text-secondary);
      font-size: 1.125rem;
      max-width: 700px;
    }
    
    /* Hero */
    .hero {
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      position: relative;
    }
    
    .hero-title .block {
      display: block;
      color: var(--color-text-muted);
      font-weight: 300;
      font-style: italic;
    }
    
    .hero-subtitle {
      margin: 0 auto 3rem;
    }
    
    .hero-meta {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      font-size: 0.875rem;
      color: var(--color-text-muted);
    }
    
    /* Corner decorations */
    .corner {
      position: absolute;
      width: 100px;
      height: 100px;
      border-color: var(--color-cyan);
      border-style: solid;
      border-width: 0;
      opacity: 0.3;
    }
    
    .corner.tl { top: 2rem; left: 2rem; border-top-width: 1px; border-left-width: 1px; }
    .corner.br { bottom: 2rem; right: 2rem; border-bottom-width: 1px; border-right-width: 1px; }
    
    /* Scan line */
    .scan-line {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--color-cyan), transparent);
      opacity: 0.5;
      animation: scan 4s ease-in-out infinite;
    }
    
    @keyframes scan {
      0%, 100% { top: 0; opacity: 0; }
      10% { opacity: 0.5; }
      90% { opacity: 0.5; }
      100% { top: 100%; opacity: 0; }
    }
    
    /* Cards */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      margin-top: 2rem;
    }
    
    .grid-2 { grid-template-columns: repeat(2, 1fr); }
    .grid-3 { grid-template-columns: repeat(3, 1fr); }
    .grid-4 { grid-template-columns: repeat(4, 1fr); }
    
    @media (max-width: 1024px) {
      .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
    }
    
    .card {
      position: relative;
      padding: 1.5rem;
      background: var(--color-bg-card);
      border: 1px solid var(--color-border);
      transition: all 0.5s var(--ease-out-expo);
    }
    
    .card::before, .card::after {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      border-color: var(--color-cyan);
      border-style: solid;
      opacity: 0;
      transition: opacity 0.5s ease;
    }
    
    .card::before { top: -1px; left: -1px; border-width: 2px 0 0 2px; }
    .card::after { bottom: -1px; right: -1px; border-width: 0 2px 2px 0; }
    
    .card:hover {
      border-color: var(--color-cyan);
      box-shadow: 0 0 40px var(--color-cyan-glow);
      transform: translateY(-4px);
    }
    
    .card:hover::before, .card:hover::after { opacity: 0.6; }
    
    .card-number {
      font-family: var(--font-mono);
      font-size: 0.75rem;
      color: var(--color-cyan);
      opacity: 0.5;
      margin-bottom: 0.75rem;
    }
    
    .card h4 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--color-text-primary);
    }
    
    .card p {
      font-size: 0.875rem;
      margin-bottom: 0;
    }
    
    /* Code blocks */
    .code-block {
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid var(--color-border);
      border-radius: 4px;
      padding: 1.5rem;
      overflow-x: auto;
      margin: 1.5rem 0;
    }
    
    .code-block pre {
      font-family: var(--font-mono);
      font-size: 0.75rem;
      line-height: 1.6;
      color: var(--color-text-secondary);
      margin: 0;
      white-space: pre;
    }
    
    .code-block .comment { color: var(--color-text-muted); }
    .code-block .keyword { color: var(--color-purple); }
    .code-block .string { color: var(--color-green); }
    .code-block .type { color: var(--color-cyan); }
    .code-block .function { color: var(--color-gold); }
    
    .code-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--color-border);
    }
    
    .code-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }
    
    .code-dot.red { background: #ff5f57; }
    .code-dot.yellow { background: #febc2e; }
    .code-dot.green { background: #28c840; }
    
    .code-title {
      font-family: var(--font-mono);
      font-size: 0.625rem;
      color: var(--color-text-muted);
      margin-left: auto;
    }
    
    /* Architecture diagram */
    .arch-diagram {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--color-border);
      padding: 2rem;
      margin: 2rem 0;
      font-family: var(--font-mono);
      font-size: 0.7rem;
      line-height: 1.4;
      overflow-x: auto;
    }
    
    .arch-diagram pre {
      color: var(--color-text-secondary);
      white-space: pre;
    }
    
    /* Table */
    .table {
      width: 100%;
      border-collapse: collapse;
      margin: 1.5rem 0;
      font-size: 0.875rem;
    }
    
    .table th, .table td {
      padding: 0.75rem 1rem;
      text-align: left;
      border-bottom: 1px solid var(--color-border);
    }
    
    .table th {
      font-family: var(--font-mono);
      font-size: 0.625rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--color-cyan);
      background: rgba(6, 182, 212, 0.05);
    }
    
    .table td {
      color: var(--color-text-secondary);
    }
    
    .table code {
      font-family: var(--font-mono);
      font-size: 0.75rem;
      background: rgba(6, 182, 212, 0.1);
      padding: 0.15rem 0.4rem;
      border-radius: 3px;
      color: var(--color-cyan);
    }
    
    /* Badges */
    .badge {
      display: inline-block;
      font-family: var(--font-mono);
      font-size: 0.625rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      padding: 0.25rem 0.75rem;
      border-radius: 2px;
    }
    
    .badge-cyan { background: rgba(6, 182, 212, 0.15); color: var(--color-cyan); }
    .badge-gold { background: rgba(201, 169, 98, 0.15); color: var(--color-gold); }
    .badge-red { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
    .badge-green { background: rgba(16, 185, 129, 0.15); color: var(--color-green); }
    .badge-purple { background: rgba(139, 92, 246, 0.15); color: var(--color-purple); }
    
    /* Stats */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1.5rem;
      margin: 2rem 0;
    }
    
    @media (max-width: 768px) {
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
    }
    
    .stat-item {
      text-align: center;
      padding: 1.5rem;
      background: var(--color-bg-card);
      border: 1px solid var(--color-border);
    }
    
    .stat-number {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--color-cyan);
      line-height: 1;
    }
    
    .stat-label {
      font-size: 0.875rem;
      color: var(--color-text-secondary);
      margin-top: 0.5rem;
    }
    
    /* Flow diagram */
    .flow {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      gap: 0;
      margin: 2rem 0;
    }
    
    .flow-step {
      padding: 1rem 1.5rem;
      background: var(--color-bg-card);
      border: 1px solid var(--color-border);
      text-align: center;
      min-width: 120px;
    }
    
    .flow-step strong {
      display: block;
      color: var(--color-text-primary);
      font-size: 0.875rem;
      margin-bottom: 0.25rem;
    }
    
    .flow-step span {
      font-size: 0.7rem;
      color: var(--color-text-muted);
    }
    
    .flow-step.active {
      border-color: var(--color-cyan);
      box-shadow: 0 0 20px var(--color-cyan-glow);
    }
    
    .flow-step.gate {
      border-color: var(--color-red);
      background: rgba(239, 68, 68, 0.05);
    }
    
    .flow-connector {
      width: 30px;
      height: 2px;
      background: var(--color-border);
      position: relative;
    }
    
    .flow-connector::after {
      content: 'â†’';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: var(--color-cyan);
      font-size: 1rem;
    }
    
    /* Timeline */
    .timeline {
      position: relative;
      margin: 2rem 0;
      padding-left: 40px;
    }
    
    .timeline::before {
      content: '';
      position: absolute;
      left: 8px;
      top: 0;
      bottom: 0;
      width: 1px;
      background: linear-gradient(to bottom, var(--color-cyan), transparent);
      opacity: 0.3;
    }
    
    .timeline-item {
      position: relative;
      padding-bottom: 2rem;
    }
    
    .timeline-marker {
      position: absolute;
      left: -40px;
      top: 0;
      width: 16px;
      height: 16px;
      border: 2px solid var(--color-cyan);
      border-radius: 50%;
      background: var(--color-bg);
    }
    
    .timeline-content {
      background: var(--color-bg-card);
      border: 1px solid var(--color-border);
      padding: 1.25rem;
    }
    
    .timeline-phase {
      font-family: var(--font-mono);
      font-size: 0.625rem;
      color: var(--color-cyan);
      text-transform: uppercase;
      letter-spacing: 0.15em;
    }
    
    .timeline-content h4 {
      font-size: 1rem;
      margin: 0.5rem 0;
      color: var(--color-text-primary);
    }
    
    .timeline-content p {
      font-size: 0.875rem;
      margin-bottom: 0.75rem;
    }
    
    .timeline-duration {
      font-family: var(--font-mono);
      font-size: 0.75rem;
      color: var(--color-gold);
      background: rgba(201, 169, 98, 0.1);
      padding: 0.25rem 0.5rem;
      display: inline-block;
    }
    
    /* WhatsApp mockup */
    .whatsapp-chat {
      max-width: 400px;
      margin: 1.5rem auto;
      background: #0b141a;
      border-radius: 8px;
      overflow: hidden;
    }
    
    .whatsapp-header {
      background: #1f2c34;
      padding: 0.75rem 1rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    
    .whatsapp-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--color-cyan);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 1rem;
    }
    
    .whatsapp-name {
      font-weight: 500;
      font-size: 0.9rem;
    }
    
    .whatsapp-status {
      font-size: 0.7rem;
      color: var(--color-text-muted);
    }
    
    .whatsapp-messages {
      padding: 1rem;
      min-height: 200px;
    }
    
    .wa-msg {
      max-width: 85%;
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      margin-bottom: 0.5rem;
      font-size: 0.85rem;
      line-height: 1.4;
    }
    
    .wa-msg.incoming {
      background: #1f2c34;
      border-top-left-radius: 0;
    }
    
    .wa-msg.outgoing {
      background: #005c4b;
      margin-left: auto;
      border-top-right-radius: 0;
    }
    
    .wa-time {
      font-size: 0.6rem;
      color: var(--color-text-muted);
      text-align: right;
      margin-top: 0.25rem;
    }
    
    /* CTA section */
    .cta-section {
      text-align: center;
      padding: 8rem 0;
    }
    
    .btn {
      display: inline-block;
      font-family: var(--font-mono);
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      padding: 1rem 2.5rem;
      text-decoration: none;
      transition: all 0.4s var(--ease-out-expo);
    }
    
    .btn-primary {
      background: var(--color-gold);
      color: #000;
    }
    
    .btn-primary:hover {
      background: #D4B76E;
      box-shadow: 0 0 40px var(--color-gold-glow);
      transform: translateY(-2px);
    }
    
    /* File tree */
    .file-tree {
      font-family: var(--font-mono);
      font-size: 0.75rem;
      line-height: 1.8;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid var(--color-border);
      padding: 1.5rem;
      color: var(--color-text-secondary);
    }
    
    .file-tree .folder { color: var(--color-gold); }
    .file-tree .file { color: var(--color-text-secondary); }
    .file-tree .special { color: var(--color-cyan); }
    .file-tree .config { color: var(--color-purple); }
    
    /* Entity relationship */
    .er-diagram {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin: 2rem 0;
    }
    
    .er-table {
      background: var(--color-bg-card);
      border: 1px solid var(--color-border);
      overflow: hidden;
    }
    
    .er-table-name {
      background: rgba(6, 182, 212, 0.1);
      padding: 0.75rem;
      font-family: var(--font-mono);
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--color-cyan);
      border-bottom: 1px solid var(--color-border);
    }
    
    .er-table-cols {
      padding: 0.5rem 0.75rem;
      font-family: var(--font-mono);
      font-size: 0.7rem;
    }
    
    .er-col {
      padding: 0.25rem 0;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .er-col .key { color: var(--color-gold); }
    .er-col .fk { color: var(--color-purple); }
    .er-col .name { color: var(--color-text-secondary); }
    .er-col .type { color: var(--color-text-muted); font-size: 0.65rem; }
  </style>
</head>
<body>

<!-- ===== 01: HERO ===== -->
<section class="section hero dot-grid">
  <div class="corner tl"></div>
  <div class="corner br"></div>
  <div class="scan-line"></div>
  
  <div class="container">
    <div class="section-label fade-up">
      <div class="label-line"></div>
      <span class="label">Technical Architecture Overview</span>
    </div>
    
    <h1 class="fade-up">
      Aztec <span class="text-cyan">B.O.S</span>
      <span class="block">System Architecture</span>
    </h1>
    
    <p class="hero-subtitle fade-up">
      A comprehensive technical deep-dive into the labour control, allocation and recruitment engine built for Aztec Landscapes.
    </p>
    
    <div class="stats-grid fade-up" style="max-width: 900px; margin: 3rem auto;">
      <div class="stat-item">
        <div class="stat-number">10+</div>
        <div class="stat-label">Core Database Tables</div>
      </div>
      <div class="stat-item">
        <div class="stat-number">25+</div>
        <div class="stat-label">API Endpoints</div>
      </div>
      <div class="stat-item">
        <div class="stat-number">3</div>
        <div class="stat-label">Integration Points</div>
      </div>
      <div class="stat-item">
        <div class="stat-number">1</div>
        <div class="stat-label">AI Agent (Sophie)</div>
      </div>
    </div>
    
    <div class="hero-meta fade-up">
      <span>Prepared by Cold Lava</span>
      <span class="text-cyan">â€¢</span>
      <span>February 2026</span>
    </div>
  </div>
</section>

<!-- ===== 02: CORE PRINCIPLES ===== -->
<section class="section">
  <div class="container">
    <div class="section-label fade-up">
      <div class="label-line"></div>
      <span class="label">Foundation / 002</span>
    </div>
    
    <h2 class="fade-up">Core <span class="text-cyan">Principles</span></h2>
    
    <p class="fade-up">Five non-negotiable principles that drive every architectural decision.</p>
    
    <div class="grid" style="margin-top: 2rem;">
      <div class="card fade-up">
        <div class="card-number">01</div>
        <h4>Reallocation First</h4>
        <p>Before recruiting externally, the system always searches for existing operatives finishing other jobs. Internal pool first, adverts second.</p>
        <span class="badge badge-cyan" style="margin-top: 0.75rem;">Cost Control</span>
      </div>
      <div class="card fade-up">
        <div class="card-number">02</div>
        <h4>WhatsApp-Native</h4>
        <p>Primary communication channel for everyone. Site Managers report arrivals via WhatsApp. Operatives confirm shifts via WhatsApp. Sophie qualifies candidates via WhatsApp.</p>
        <span class="badge badge-green" style="margin-top: 0.75rem;">User Adoption</span>
      </div>
      <div class="card fade-up">
        <div class="card-number">03</div>
        <h4>Compliance Built-In</h4>
        <p>No operative can start work without verified RTW, Photo ID, and in-date CSCS. The system blocks non-compliant allocations automatically.</p>
        <span class="badge badge-red" style="margin-top: 0.75rem;">Zero Exceptions</span>
      </div>
      <div class="card fade-up">
        <div class="card-number">04</div>
        <h4>AI-Assisted Intake</h4>
        <p>Sophie handles candidate screening 24/7 â€” collecting details, validating documents, and qualifying candidates before they reach Liam.</p>
        <span class="badge badge-purple" style="margin-top: 0.75rem;">Automation</span>
      </div>
      <div class="card fade-up">
        <div class="card-number">05</div>
        <h4>Performance-Tracked</h4>
        <p>Every operative is graded 1-5 after each job. NCRs are logged instantly. Poor performers are blocked. Quality operatives rise to the top.</p>
        <span class="badge badge-gold" style="margin-top: 0.75rem;">Quality Control</span>
      </div>
    </div>
  </div>
</section>

<!-- ===== 03: SYSTEM ARCHITECTURE ===== -->
<section class="section line-grid">
  <div class="container">
    <div class="section-label fade-up">
      <div class="label-line"></div>
      <span class="label">Architecture / 003</span>
    </div>
    
    <h2 class="fade-up">System <span class="text-cyan">Architecture</span></h2>
    
    <p class="fade-up">Complete technical architecture showing all system components and data flows.</p>
    
    <div class="arch-diagram fade-up">
      <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    USER INTERFACES                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    â”‚                    â”‚                    â”‚                         â”‚
â”‚  <span class="text-cyan">LIAM DASHBOARD</span>    â”‚  <span class="text-gold">SITE MANAGER</span>      â”‚  <span class="text-purple">SOPHIE AI</span>         â”‚  <span class="text-green">OPERATIVE</span>             â”‚
â”‚  (Web Application) â”‚  (WhatsApp Bot)    â”‚  (WhatsApp Agent)  â”‚  (WhatsApp)             â”‚
â”‚                    â”‚                    â”‚                    â”‚                         â”‚
â”‚  â€¢ Labour Search   â”‚  â€¢ Arrival Confirm â”‚  â€¢ Candidate Intakeâ”‚  â€¢ Shift Confirmation   â”‚
â”‚  â€¢ Allocations     â”‚  â€¢ NCR Reports     â”‚  â€¢ Document Upload â”‚  â€¢ Induction Forms      â”‚
â”‚  â€¢ Compliance      â”‚  â€¢ Performance     â”‚  â€¢ Qualification   â”‚  â€¢ Availability         â”‚
â”‚  â€¢ Reporting       â”‚  â€¢ Replacement Req â”‚  â€¢ Follow-ups      â”‚  â€¢ Referrals            â”‚
â”‚                    â”‚                    â”‚                    â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                    â”‚                    â”‚                      â”‚
          â”‚                    â”‚                    â”‚                      â”‚
          â–¼                    â–¼                    â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                          â”‚
â”‚                           <span class="text-cyan">NEXT.JS API LAYER</span> (Serverless Functions)                      â”‚
â”‚                                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ /operatives  â”‚  â”‚ /allocations â”‚  â”‚ /ncrs        â”‚  â”‚ /documents   â”‚  â”‚ /webhooks  â”‚ â”‚
â”‚  â”‚ CRUD+Search  â”‚  â”‚ Assign+Track â”‚  â”‚ Log+Block    â”‚  â”‚ Upload+Verifyâ”‚  â”‚ WhatsApp   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                         â”‚                         â”‚
          â–¼                         â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  â”‚    â”‚                    â”‚    â”‚                                     â”‚
â”‚  <span class="text-cyan">POSTGRESQL</span>       â”‚    â”‚  <span class="text-gold">SUPABASE STORAGE</span>  â”‚    â”‚  <span class="text-green">EXTERNAL SERVICES</span>                  â”‚
â”‚  (Supabase)      â”‚    â”‚  (Documents)       â”‚    â”‚                                     â”‚
â”‚                  â”‚    â”‚                    â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â€¢ operatives    â”‚    â”‚  â€¢ CSCS Cards      â”‚    â”‚  â”‚ WhatsApp    â”‚  â”‚ OpenAI GPT-4 â”‚  â”‚
â”‚  â€¢ sites         â”‚    â”‚  â€¢ Photo IDs       â”‚    â”‚  â”‚ Business    â”‚  â”‚ (Sophie)     â”‚  â”‚
â”‚  â€¢ allocations   â”‚    â”‚  â€¢ RTW Documents   â”‚    â”‚  â”‚ API         â”‚  â”‚              â”‚  â”‚
â”‚  â€¢ documents     â”‚    â”‚  â€¢ Plant Tickets   â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â€¢ ncrs          â”‚    â”‚  â€¢ CVs             â”‚    â”‚                                     â”‚
â”‚  â€¢ comms_log     â”‚    â”‚                    â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â€¢ attendance    â”‚    â”‚                    â”‚    â”‚  â”‚ Gov.uk RTW  â”‚  â”‚ Twilio       â”‚  â”‚
â”‚  â€¢ reviews       â”‚    â”‚                    â”‚    â”‚  â”‚ Check API   â”‚  â”‚ (SMS Backup) â”‚  â”‚
â”‚                  â”‚    â”‚                    â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                  â”‚    â”‚                    â”‚    â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      </pre>
    </div>
    
    <div class="grid grid-3 fade-up">
      <div class="card">
        <h4 class="text-cyan">Frontend</h4>
        <p>Next.js 15 with App Router. Server-side rendering for fast page loads. Real-time updates via Supabase subscriptions.</p>
      </div>
      <div class="card">
        <h4 class="text-gold">Database</h4>
        <p>PostgreSQL via Supabase. Row-level security for multi-tenant isolation. Full-text search on operatives.</p>
      </div>
      <div class="card">
        <h4 class="text-green">Integrations</h4>
        <p>WhatsApp Business API for all messaging. OpenAI for Sophie. Gov.uk for RTW verification.</p>
      </div>
    </div>
  </div>
</section>

<!-- ===== 04: DATABASE SCHEMA ===== -->
<section class="section dot-grid">
  <div class="container">
    <div class="section-label fade-up">
      <div class="label-line"></div>
      <span class="label">Database / 004</span>
    </div>
    
    <h2 class="fade-up">Database <span class="text-cyan">Schema</span></h2>
    
    <p class="fade-up">10 core tables with full referential integrity, optimized indexes, and automated triggers.</p>
    
    <div class="er-diagram fade-up">
      <div class="er-table">
        <div class="er-table-name">operatives</div>
        <div class="er-table-cols">
          <div class="er-col"><span class="key">ğŸ”‘</span> <span class="name">id</span> <span class="type">UUID</span></div>
          <div class="er-col"><span class="name">first_name, last_name</span> <span class="type">VARCHAR</span></div>
          <div class="er-col"><span class="name">phone, email</span> <span class="type">VARCHAR</span></div>
          <div class="er-col"><span class="fk">â†’</span> <span class="name">trade_category_id</span> <span class="type">UUID</span></div>
          <div class="er-col"><span class="name">day_rate</span> <span class="type">DECIMAL</span></div>
          <div class="er-col"><span class="name">status</span> <span class="type">ENUM</span></div>
          <div class="er-col"><span class="name">avg_rating</span> <span class="type">DECIMAL</span></div>
          <div class="er-col"><span class="name">cscs_expiry, rtw_expiry</span> <span class="type">DATE</span></div>
        </div>
      </div>
      
      <div class="er-table">
        <div class="er-table-name">sites</div>
        <div class="er-table-cols">
          <div class="er-col"><span class="key">ğŸ”‘</span> <span class="name">id</span> <span class="type">UUID</span></div>
          <div class="er-col"><span class="name">name</span> <span class="type">VARCHAR</span></div>
          <div class="er-col"><span class="name">address, postcode</span> <span class="type">TEXT</span></div>
          <div class="er-col"><span class="name">lat, lng</span> <span class="type">DECIMAL</span></div>
          <div class="er-col"><span class="fk">â†’</span> <span class="name">site_manager_id</span> <span class="type">UUID</span></div>
          <div class="er-col"><span class="name">is_active</span> <span class="type">BOOLEAN</span></div>
        </div>
      </div>
      
      <div class="er-table">
        <div class="er-table-name">allocations</div>
        <div class="er-table-cols">
          <div class="er-col"><span class="key">ğŸ”‘</span> <span class="name">id</span> <span class="type">UUID</span></div>
          <div class="er-col"><span class="fk">â†’</span> <span class="name">operative_id</span> <span class="type">UUID</span></div>
          <div class="er-col"><span class="fk">â†’</span> <span class="name">site_id</span> <span class="type">UUID</span></div>
          <div class="er-col"><span class="name">start_date, end_date</span> <span class="type">DATE</span></div>
          <div class="er-col"><span class="name">agreed_day_rate</span> <span class="type">DECIMAL</span></div>
          <div class="er-col"><span class="name">status</span> <span class="type">ENUM</span></div>
          <div class="er-col"><span class="name">induction_completed</span> <span class="type">BOOLEAN</span></div>
        </div>
      </div>
      
      <div class="er-table">
        <div class="er-table-name">documents</div>
        <div class="er-table-cols">
          <div class="er-col"><span class="key">ğŸ”‘</span> <span class="name">id</span> <span class="type">UUID</span></div>
          <div class="er-col"><span class="fk">â†’</span> <span class="name">operative_id</span> <span class="type">UUID</span></div>
          <div class="er-col"><span class="name">document_type</span> <span class="type">ENUM</span></div>
          <div class="er-col"><span class="name">file_url</span> <span class="type">TEXT</span></div>
          <div class="er-col"><span class="name">expiry_date</span> <span class="type">DATE</span></div>
          <div class="er-col"><span class="name">is_verified</span> <span class="type">BOOLEAN</span></div>
          <div class="er-col"><span class="name">rtw_share_code</span> <span class="type">VARCHAR</span></div>
        </div>
      </div>
      
      <div class="er-table">
        <div class="er-table-name">ncrs</div>
        <div class="er-table-cols">
          <div class="er-col"><span class="key">ğŸ”‘</span> <span class="name">id</span> <span class="type">UUID</span></div>
          <div class="er-col"><span class="fk">â†’</span> <span class="name">operative_id</span> <span class="type">UUID</span></div>
          <div class="er-col"><span class="fk">â†’</span> <span class="name">site_id</span> <span class="type">UUID</span></div>
          <div class="er-col"><span class="name">incident_type</span> <span class="type">ENUM</span></div>
          <div class="er-col"><span class="name">severity</span> <span class="type">ENUM</span></div>
          <div class="er-col"><span class="name">description</span> <span class="type">TEXT</span></div>
          <div class="er-col"><span class="name">resulted_in_block</span> <span class="type">BOOLEAN</span></div>
        </div>
      </div>
      
      <div class="er-table">
        <div class="er-table-name">communication_log</div>
        <div class="er-table-cols">
          <div class="er-col"><span class="key">ğŸ”‘</span> <span class="name">id</span> <span class="type">UUID</span></div>
          <div class="er-col"><span class="fk">â†’</span> <span class="name">operative_id</span> <span class="type">UUID</span></div>
          <div class="er-col"><span class="name">channel</span> <span class="type">ENUM</span></div>
          <div class="er-col"><span class="name">direction</span> <span class="type">ENUM</span></div>
          <div class="er-col"><span class="name">message_body</span> <span class="type">TEXT</span></div>
          <div class="er-col"><span class="name">status</span> <span class="type">VARCHAR</span></div>
          <div class="er-col"><span class="name">sent_at</span> <span class="type">TIMESTAMP</span></div>
        </div>
      </div>
    </div>
    
    <h3 class="fade-up" style="margin-top: 3rem;">Operatives Table â€” Full Schema</h3>
    
    <div class="code-block fade-up">
      <div class="code-header">
        <span class="code-dot red"></span>
        <span class="code-dot yellow"></span>
        <span class="code-dot green"></span>
        <span class="code-title">operatives.sql</span>
      </div>
      <pre><span class="comment">-- The labour pool: every operative in the system</span>
<span class="keyword">CREATE TABLE</span> <span class="type">operatives</span> (
  id <span class="type">UUID</span> <span class="keyword">PRIMARY KEY DEFAULT</span> <span class="function">gen_random_uuid</span>(),
  
  <span class="comment">-- Personal Information</span>
  first_name <span class="type">VARCHAR(100)</span> <span class="keyword">NOT NULL</span>,
  last_name <span class="type">VARCHAR(100)</span> <span class="keyword">NOT NULL</span>,
  phone <span class="type">VARCHAR(20)</span> <span class="keyword">NOT NULL UNIQUE</span>,
  email <span class="type">VARCHAR(255)</span>,
  date_of_birth <span class="type">DATE</span>,
  nationality <span class="type">VARCHAR(100)</span>,
  languages <span class="type">TEXT[]</span>,  <span class="comment">-- ['English', 'Polish', 'Romanian']</span>
  
  <span class="comment">-- Location & Travel</span>
  address <span class="type">TEXT</span>,
  postcode <span class="type">VARCHAR(10)</span>,
  travel_radius_miles <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="string">25</span>,
  
  <span class="comment">-- Role & Skills</span>
  labour_type <span class="type">labour_type</span> <span class="keyword">NOT NULL DEFAULT</span> <span class="string">'blue_collar'</span>,
  trade_category_id <span class="type">UUID</span> <span class="keyword">REFERENCES</span> trade_categories(id),
  skills <span class="type">TEXT[]</span>,
  years_experience <span class="type">INT</span>,
  
  <span class="comment">-- Rates</span>
  day_rate <span class="type">DECIMAL(8,2)</span>,
  hourly_rate <span class="type">DECIMAL(6,2)</span> <span class="keyword">GENERATED ALWAYS AS</span> (day_rate / 8) <span class="keyword">STORED</span>,
  
  <span class="comment">-- Compliance (denormalized for fast queries)</span>
  rtw_verified <span class="type">BOOLEAN</span> <span class="keyword">DEFAULT</span> <span class="string">false</span>,
  rtw_expiry <span class="type">DATE</span>,
  cscs_card_type <span class="type">VARCHAR(100)</span>,
  cscs_expiry <span class="type">DATE</span>,
  
  <span class="comment">-- Performance Metrics (auto-calculated via triggers)</span>
  avg_rating <span class="type">DECIMAL(3,2)</span>,
  total_jobs <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="string">0</span>,
  would_reemploy_count <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="string">0</span>,
  
  <span class="comment">-- Status Management</span>
  status <span class="type">VARCHAR(50)</span> <span class="keyword">CHECK</span> (status <span class="keyword">IN</span> (
    <span class="string">'prospect'</span>,      <span class="comment">-- Responded to ad</span>
    <span class="string">'qualifying'</span>,    <span class="comment">-- Sophie is screening</span>
    <span class="string">'pending_docs'</span>,  <span class="comment">-- Awaiting documents</span>
    <span class="string">'verified'</span>,      <span class="comment">-- Ready to work</span>
    <span class="string">'working'</span>,       <span class="comment">-- Currently on a job</span>
    <span class="string">'available'</span>,     <span class="comment">-- Verified and free</span>
    <span class="string">'blocked'</span>        <span class="comment">-- NCR'd, do not use</span>
  )) <span class="keyword">DEFAULT</span> <span class="string">'prospect'</span>,
  
  blocked_reason <span class="type">TEXT</span>,
  source <span class="type">VARCHAR(100)</span>,  <span class="comment">-- 'facebook', 'referral', etc.</span>
  
  created_at <span class="type">TIMESTAMPTZ</span> <span class="keyword">DEFAULT NOW</span>(),
  updated_at <span class="type">TIMESTAMPTZ</span> <span class="keyword">DEFAULT NOW</span>()
);

<span class="comment">-- Indexes for fast searching</span>
<span class="keyword">CREATE INDEX</span> idx_operatives_status <span class="keyword">ON</span> operatives(status);
<span class="keyword">CREATE INDEX</span> idx_operatives_trade <span class="keyword">ON</span> operatives(trade_category_id);
<span class="keyword">CREATE INDEX</span> idx_operatives_postcode <span class="keyword">ON</span> operatives(postcode);
<span class="keyword">CREATE INDEX</span> idx_operatives_rating <span class="keyword">ON</span> operatives(avg_rating <span class="keyword">DESC NULLS LAST</span>);
<span class="keyword">CREATE INDEX</span> idx_operatives_cscs_expiry <span class="keyword">ON</span> operatives(cscs_expiry);
<span class="keyword">CREATE INDEX</span> idx_operatives_available <span class="keyword">ON</span> operatives(status) 
  <span class="keyword">WHERE</span> status <span class="keyword">IN</span> (<span class="string">'verified'</span>, <span class="string">'available'</span>);</pre>
    </div>
  </div>
</section>

<!-- ===== 05: FILE STRUCTURE ===== -->
<section class="section">
  <div class="container">
    <div class="section-label fade-up">
      <div class="label-line"></div>
      <span class="label">Project Structure / 005</span>
    </div>
    
    <h2 class="fade-up">Project <span class="text-cyan">Structure</span></h2>
    
    <p class="fade-up">Organized, scalable Next.js application following enterprise patterns.</p>
    
    <div class="grid grid-2 fade-up" style="align-items: start;">
      <div class="file-tree">
<pre><span class="folder">aztec-bos/</span>
â”œâ”€â”€ <span class="folder">src/</span>
â”‚   â”œâ”€â”€ <span class="folder">app/</span>                    <span class="comment"># Next.js App Router</span>
â”‚   â”‚   â”œâ”€â”€ <span class="folder">(dashboard)/</span>         <span class="comment"># Protected routes</span>
â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="folder">dashboard/</span>
â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="folder">operatives/</span>
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="file">page.tsx</span>       <span class="comment"># List view</span>
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="file">[id]/page.tsx</span>  <span class="comment"># Detail view</span>
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ <span class="file">new/page.tsx</span>   <span class="comment"># Create form</span>
â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="folder">sites/</span>
â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="folder">allocations/</span>
â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="folder">ncrs/</span>
â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="folder">documents/</span>
â”‚   â”‚   â”‚   â””â”€â”€ <span class="special">layout.tsx</span>       <span class="comment"># Dashboard shell</span>
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ <span class="folder">api/</span>                  <span class="comment"># API Routes</span>
â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="folder">v1/</span>
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="folder">operatives/</span>
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="folder">allocations/</span>
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ <span class="folder">ncrs/</span>
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ <span class="folder">documents/</span>
â”‚   â”‚   â”‚   â””â”€â”€ <span class="folder">webhooks/</span>
â”‚   â”‚   â”‚       â””â”€â”€ <span class="special">whatsapp/route.ts</span>
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ <span class="folder">(auth)/</span>              <span class="comment"># Auth routes</span>
â”‚   â”‚   â”‚   â””â”€â”€ <span class="file">login/page.tsx</span>
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ <span class="config">layout.tsx</span>           <span class="comment"># Root layout</span>
â”‚   â”‚   â””â”€â”€ <span class="config">globals.css</span>
â”‚   â”‚
â”‚   â”œâ”€â”€ <span class="folder">components/</span>
â”‚   â”‚   â”œâ”€â”€ <span class="folder">ui/</span>                  <span class="comment"># shadcn/ui components</span>
â”‚   â”‚   â”œâ”€â”€ <span class="folder">operatives/</span>
â”‚   â”‚   â”œâ”€â”€ <span class="folder">allocations/</span>
â”‚   â”‚   â””â”€â”€ <span class="folder">dashboard/</span>
â”‚   â”‚
â”‚   â”œâ”€â”€ <span class="folder">lib/</span>
â”‚   â”‚   â”œâ”€â”€ <span class="special">supabase/</span>            <span class="comment"># DB client & queries</span>
â”‚   â”‚   â”œâ”€â”€ <span class="special">whatsapp/</span>            <span class="comment"># WhatsApp API</span>
â”‚   â”‚   â”œâ”€â”€ <span class="special">sophie/</span>              <span class="comment"># AI agent logic</span>
â”‚   â”‚   â””â”€â”€ <span class="file">utils.ts</span>
â”‚   â”‚
â”‚   â””â”€â”€ <span class="folder">types/</span>
â”‚       â””â”€â”€ <span class="file">database.ts</span>          <span class="comment"># Generated types</span>
â”‚
â”œâ”€â”€ <span class="folder">supabase/</span>
â”‚   â””â”€â”€ <span class="folder">migrations/</span>            <span class="comment"># SQL migrations</span>
â”‚
â”œâ”€â”€ <span class="config">next.config.ts</span>
â”œâ”€â”€ <span class="config">package.json</span>
â””â”€â”€ <span class="config">tsconfig.json</span></pre>
      </div>
      
      <div>
        <h3>Key Directories</h3>
        
        <div class="card" style="margin-bottom: 1rem;">
          <h4><code>src/app/(dashboard)/</code></h4>
          <p>All authenticated routes. Liam's main workspace. Protected by middleware.</p>
        </div>
        
        <div class="card" style="margin-bottom: 1rem;">
          <h4><code>src/app/api/v1/</code></h4>
          <p>RESTful API endpoints. Versioned for future compatibility. Server-side data operations.</p>
        </div>
        
        <div class="card" style="margin-bottom: 1rem;">
          <h4><code>src/lib/sophie/</code></h4>
          <p>Sophie AI agent. OpenAI integration. Conversation state machine. Candidate qualification logic.</p>
        </div>
        
        <div class="card" style="margin-bottom: 1rem;">
          <h4><code>supabase/migrations/</code></h4>
          <p>Version-controlled database schema. Run in order. Full audit trail of changes.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ===== 06: API ENDPOINTS ===== -->
<section class="section line-grid">
  <div class="container">
    <div class="section-label fade-up">
      <div class="label-line"></div>
      <span class="label">API Design / 006</span>
    </div>
    
    <h2 class="fade-up">API <span class="text-cyan">Endpoints</span></h2>
    
    <p class="fade-up">RESTful API with 25+ endpoints covering all business operations.</p>
    
    <table class="table fade-up">
      <thead>
        <tr>
          <th>Method</th>
          <th>Endpoint</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><span class="badge badge-green">GET</span></td>
          <td><code>/api/v1/operatives</code></td>
          <td>List operatives with filters (trade, status, location, rating)</td>
        </tr>
        <tr>
          <td><span class="badge badge-cyan">POST</span></td>
          <td><code>/api/v1/operatives</code></td>
          <td>Create new operative record</td>
        </tr>
        <tr>
          <td><span class="badge badge-green">GET</span></td>
          <td><code>/api/v1/operatives/:id</code></td>
          <td>Get operative details with documents, history</td>
        </tr>
        <tr>
          <td><span class="badge badge-gold">PATCH</span></td>
          <td><code>/api/v1/operatives/:id</code></td>
          <td>Update operative (status, details, block)</td>
        </tr>
        <tr>
          <td><span class="badge badge-green">GET</span></td>
          <td><code>/api/v1/operatives/search</code></td>
          <td>Advanced search with full-text, geo, filters</td>
        </tr>
        <tr><td colspan="3" style="height: 1rem;"></td></tr>
        <tr>
          <td><span class="badge badge-cyan">POST</span></td>
          <td><code>/api/v1/allocations</code></td>
          <td>Assign operative to site</td>
        </tr>
        <tr>
          <td><span class="badge badge-cyan">POST</span></td>
          <td><code>/api/v1/allocations/:id/confirm</code></td>
          <td>Operative confirms allocation</td>
        </tr>
        <tr>
          <td><span class="badge badge-cyan">POST</span></td>
          <td><code>/api/v1/allocations/:id/complete</code></td>
          <td>Mark allocation as complete, trigger review</td>
        </tr>
        <tr><td colspan="3" style="height: 1rem;"></td></tr>
        <tr>
          <td><span class="badge badge-cyan">POST</span></td>
          <td><code>/api/v1/ncrs</code></td>
          <td>Log NCR against operative</td>
        </tr>
        <tr>
          <td><span class="badge badge-green">GET</span></td>
          <td><code>/api/v1/ncrs/operative/:id</code></td>
          <td>Get all NCRs for an operative</td>
        </tr>
        <tr><td colspan="3" style="height: 1rem;"></td></tr>
        <tr>
          <td><span class="badge badge-cyan">POST</span></td>
          <td><code>/api/v1/documents</code></td>
          <td>Upload document (RTW, CSCS, etc.)</td>
        </tr>
        <tr>
          <td><span class="badge badge-green">GET</span></td>
          <td><code>/api/v1/documents/expiring</code></td>
          <td>List documents expiring within N days</td>
        </tr>
        <tr>
          <td><span class="badge badge-gold">PATCH</span></td>
          <td><code>/api/v1/documents/:id/verify</code></td>
          <td>Mark document as verified</td>
        </tr>
        <tr><td colspan="3" style="height: 1rem;"></td></tr>
        <tr>
          <td><span class="badge badge-cyan">POST</span></td>
          <td><code>/api/v1/attendance/confirm</code></td>
          <td>Site Manager confirms arrival</td>
        </tr>
        <tr>
          <td><span class="badge badge-cyan">POST</span></td>
          <td><code>/api/v1/reviews</code></td>
          <td>Submit performance review (1-5 rating)</td>
        </tr>
        <tr><td colspan="3" style="height: 1rem;"></td></tr>
        <tr>
          <td><span class="badge badge-purple">POST</span></td>
          <td><code>/api/webhooks/whatsapp</code></td>
          <td>Receive WhatsApp messages (route to Sophie or Site Manager handler)</td>
        </tr>
      </tbody>
    </table>
  </div>
</section>

<!-- ===== 07: SOPHIE AI ===== -->
<section class="section dot-grid">
  <div class="container">
    <div class="section-label fade-up">
      <div class="label-line"></div>
      <span class="label">Sophie AI / 007</span>
    </div>
    
    <h2 class="fade-up"><span class="text-purple">Sophie</span> AI Agent</h2>
    
    <p class="fade-up">AI-powered recruitment assistant with a structured qualification flow and mandatory gates.</p>
    
    <h3 class="fade-up" style="margin-top: 2rem;">Conversation State Machine</h3>
    
    <div class="flow fade-up" style="flex-wrap: wrap; gap: 0.5rem;">
      <div class="flow-step active"><strong>Greeting</strong><span>Present job</span></div>
      <div class="flow-connector"></div>
      <div class="flow-step gate"><strong>RTW Check</strong><span>GATE 1</span></div>
      <div class="flow-connector"></div>
      <div class="flow-step gate"><strong>Age 18+</strong><span>GATE 2</span></div>
      <div class="flow-connector"></div>
      <div class="flow-step"><strong>CSCS</strong><span>Card type</span></div>
      <div class="flow-connector"></div>
      <div class="flow-step"><strong>Personal</strong><span>Name, DOB</span></div>
      <div class="flow-connector"></div>
      <div class="flow-step"><strong>Skills</strong><span>Experience</span></div>
      <div class="flow-connector"></div>
      <div class="flow-step"><strong>Docs</strong><span>Upload request</span></div>
      <div class="flow-connector"></div>
      <div class="flow-step active"><strong>Complete</strong><span>Pass to Liam</span></div>
    </div>
    
    <div class="grid grid-2 fade-up" style="margin-top: 2rem;">
      <div>
        <h3>Sophie's Qualification Logic</h3>
        
        <div class="code-block">
          <div class="code-header">
            <span class="code-dot red"></span>
            <span class="code-dot yellow"></span>
            <span class="code-dot green"></span>
            <span class="code-title">sophie/qualify.ts</span>
          </div>
          <pre><span class="keyword">type</span> <span class="type">SophieState</span> =
  | <span class="string">'greeting'</span>
  | <span class="string">'check_rtw'</span>        <span class="comment">// Gate 1: MUST pass</span>
  | <span class="string">'check_age'</span>        <span class="comment">// Gate 2: MUST pass</span>
  | <span class="string">'check_cscs'</span>
  | <span class="string">'collect_name'</span>
  | <span class="string">'collect_dob'</span>
  | <span class="string">'collect_nationality'</span>
  | <span class="string">'collect_languages'</span>
  | <span class="string">'collect_medical'</span>   <span class="comment">// Required</span>
  | <span class="string">'collect_skills'</span>
  | <span class="string">'collect_experience'</span>
  | <span class="string">'collect_employers'</span>
  | <span class="string">'request_documents'</span>
  | <span class="string">'complete'</span>
  | <span class="string">'rejected'</span>

<span class="keyword">async function</span> <span class="function">processMessage</span>(
  conversation: <span class="type">SophieConversation</span>,
  message: <span class="type">string</span>
) {
  <span class="keyword">const</span> { state, jobDetails } = conversation;
  
  <span class="comment">// Gate 1: Right to Work</span>
  <span class="keyword">if</span> (state === <span class="string">'check_rtw'</span>) {
    <span class="keyword">if</span> (!<span class="function">isPositive</span>(message)) {
      <span class="keyword">return</span> {
        newState: <span class="string">'rejected'</span>,
        reply: <span class="string">'Sorry, you must have the right '</span> +
               <span class="string">'to work in the UK for this role.'</span>
      };
    }
  }
  
  <span class="comment">// Gate 2: Age 18+</span>
  <span class="keyword">if</span> (state === <span class="string">'check_age'</span>) {
    <span class="keyword">if</span> (!<span class="function">isPositive</span>(message)) {
      <span class="keyword">return</span> {
        newState: <span class="string">'rejected'</span>,
        reply: <span class="string">'Sorry, you must be 18+ '</span> +
               <span class="string">'for site work.'</span>
      };
    }
  }
  
  <span class="comment">// Continue through state machine...</span>
}</pre>
        </div>
      </div>
      
      <div>
        <h3>Sample Conversation</h3>
        
        <div class="whatsapp-chat">
          <div class="whatsapp-header">
            <div class="whatsapp-avatar">S</div>
            <div>
              <div class="whatsapp-name">Sophie @ Aztec</div>
              <div class="whatsapp-status">AI Assistant</div>
            </div>
          </div>
          <div class="whatsapp-messages">
            <div class="wa-msg incoming">
              Hi! ğŸ‘‹ I'm Sophie from Aztec Landscapes.
              <br><br>
              I saw you responded to our ad for a <strong>Groundworker</strong> in <strong>Manchester</strong> at <strong>Â£180/day</strong> starting Monday.
              <br><br>
              Are you interested in this role?
              <div class="wa-time">09:15</div>
            </div>
            <div class="wa-msg outgoing">
              Yes definitely
              <div class="wa-time">09:16</div>
            </div>
            <div class="wa-msg incoming">
              Great! First question: Do you have the right to work in the UK?
              <div class="wa-time">09:16</div>
            </div>
            <div class="wa-msg outgoing">
              Yes I'm British
              <div class="wa-time">09:17</div>
            </div>
            <div class="wa-msg incoming">
              Perfect âœ… And are you 18 or over?
              <div class="wa-time">09:17</div>
            </div>
            <div class="wa-msg outgoing">
              Yeah 26
              <div class="wa-time">09:17</div>
            </div>
            <div class="wa-msg incoming">
              Great! Do you have a valid CSCS card? If so, what type and when does it expire?
              <div class="wa-time">09:18</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ===== 08: WHATSAPP FLOWS ===== -->
<section class="section">
  <div class="container">
    <div class="section-label fade-up">
      <div class="label-line"></div>
      <span class="label">WhatsApp Integration / 008</span>
    </div>
    
    <h2 class="fade-up">WhatsApp <span class="text-green">Flows</span></h2>
    
    <p class="fade-up">Real message templates for common workflows.</p>
    
    <div class="grid grid-3 fade-up" style="margin-top: 2rem;">
      <div>
        <h3>Arrival Confirmation</h3>
        <div class="whatsapp-chat" style="max-width: 100%;">
          <div class="whatsapp-header">
            <div class="whatsapp-avatar text-cyan">A</div>
            <div>
              <div class="whatsapp-name">Aztec BOS</div>
              <div class="whatsapp-status">Site Manager Bot</div>
            </div>
          </div>
          <div class="whatsapp-messages" style="min-height: 180px;">
            <div class="wa-msg incoming">
              Good morning! ğŸŒ…
              <br><br>
              Did <strong>John Smith</strong> arrive at <strong>Westfield Site</strong> today?
              <br><br>
              Reply YES or NO
              <div class="wa-time">07:15</div>
            </div>
            <div class="wa-msg outgoing">
              YES
              <div class="wa-time">07:18</div>
            </div>
            <div class="wa-msg incoming">
              âœ… John Smith marked as arrived.
              <br>Have a great day!
              <div class="wa-time">07:18</div>
            </div>
          </div>
        </div>
      </div>
      
      <div>
        <h3>NCR Report</h3>
        <div class="whatsapp-chat" style="max-width: 100%;">
          <div class="whatsapp-header">
            <div class="whatsapp-avatar text-red">!</div>
            <div>
              <div class="whatsapp-name">Site Manager</div>
              <div class="whatsapp-status">NCR Flow</div>
            </div>
          </div>
          <div class="whatsapp-messages" style="min-height: 180px;">
            <div class="wa-msg outgoing">
              Red card John Smith - walked off site without permission
              <div class="wa-time">14:30</div>
            </div>
            <div class="wa-msg incoming">
              âš ï¸ <strong>NCR Logged</strong>
              <br>Operative: John Smith
              <br>Type: Walk Off
              <br>Site: Westfield
              <br><br>
              Do you need a replacement?
              <br>Reply YES or NO
              <div class="wa-time">14:30</div>
            </div>
            <div class="wa-msg outgoing">
              YES
              <div class="wa-time">14:31</div>
            </div>
            <div class="wa-msg incoming">
              Got it. Liam has been notified and will arrange a replacement ASAP. ğŸ”„
              <div class="wa-time">14:31</div>
            </div>
          </div>
        </div>
      </div>
      
      <div>
        <h3>Shift Confirmation</h3>
        <div class="whatsapp-chat" style="max-width: 100%;">
          <div class="whatsapp-header">
            <div class="whatsapp-avatar text-gold">A</div>
            <div>
              <div class="whatsapp-name">Aztec BOS</div>
              <div class="whatsapp-status">Operative Flow</div>
            </div>
          </div>
          <div class="whatsapp-messages" style="min-height: 180px;">
            <div class="wa-msg incoming">
              Hi John! ğŸ‘‹
              <br><br>
              You've been assigned to:
              <br>ğŸ“ Westfield Site, W12 7GF
              <br>ğŸ“… Monday 5th Feb
              <br>ğŸ’· Â£180/day
              <br>â° Report: 7:00 AM
              <br>ğŸ‘¤ Ask for: Mike
              <br><br>
              Confirm? Reply YES or NO
              <div class="wa-time">16:00</div>
            </div>
            <div class="wa-msg outgoing">
              YES
              <div class="wa-time">16:05</div>
            </div>
            <div class="wa-msg incoming">
              âœ… Confirmed for Westfield Site!
              <br><br>
              I'll send induction forms shortly.
              <br>See you Monday! ğŸš§
              <div class="wa-time">16:05</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ===== 09: COMPLIANCE ENGINE ===== -->
<section class="section line-grid">
  <div class="container">
    <div class="section-label fade-up">
      <div class="label-line"></div>
      <span class="label">Compliance / 009</span>
    </div>
    
    <h2 class="fade-up">Compliance <span class="text-red">Engine</span></h2>
    
    <p class="fade-up">Automated pre-start checks and document expiry tracking.</p>
    
    <div class="grid grid-2 fade-up" style="margin-top: 2rem; align-items: start;">
      <div>
        <h3>Pre-Start Validation</h3>
        
        <div class="code-block">
          <div class="code-header">
            <span class="code-dot red"></span>
            <span class="code-dot yellow"></span>
            <span class="code-dot green"></span>
            <span class="code-title">compliance/canStart.ts</span>
          </div>
          <pre><span class="keyword">async function</span> <span class="function">canOperativeStart</span>(
  operativeId: <span class="type">string</span>
): <span class="type">Promise</span>&lt;{
  canStart: <span class="type">boolean</span>;
  blockers: <span class="type">string</span>[];
}&gt; {
  <span class="keyword">const</span> op = <span class="keyword">await</span> db.operative.<span class="function">findById</span>(operativeId);
  <span class="keyword">const</span> blockers: <span class="type">string</span>[] = [];
  
  <span class="comment">// 1. Right to Work verified</span>
  <span class="keyword">if</span> (!op.rtwVerified) {
    blockers.<span class="function">push</span>(<span class="string">'RTW not verified'</span>);
  }
  
  <span class="comment">// 2. RTW not expired</span>
  <span class="keyword">if</span> (op.rtwExpiry && op.rtwExpiry < <span class="keyword">new</span> <span class="type">Date</span>()) {
    blockers.<span class="function">push</span>(<span class="string">'RTW expired'</span>);
  }
  
  <span class="comment">// 3. Photo ID on file</span>
  <span class="keyword">const</span> photoId = <span class="keyword">await</span> db.documents.<span class="function">findOne</span>({
    operativeId,
    documentType: <span class="string">'photo_id'</span>
  });
  <span class="keyword">if</span> (!photoId) {
    blockers.<span class="function">push</span>(<span class="string">'Photo ID missing'</span>);
  }
  
  <span class="comment">// 4. CSCS in date</span>
  <span class="keyword">if</span> (!op.cscsExpiry || op.cscsExpiry < <span class="keyword">new</span> <span class="type">Date</span>()) {
    blockers.<span class="function">push</span>(<span class="string">'CSCS expired/missing'</span>);
  }
  
  <span class="comment">// 5. Not blocked</span>
  <span class="keyword">if</span> (op.status === <span class="string">'blocked'</span>) {
    blockers.<span class="function">push</span>(<span class="string">`Blocked: ${op.blockedReason}`</span>);
  }
  
  <span class="keyword">return</span> {
    canStart: blockers.length === <span class="string">0</span>,
    blockers
  };
}</pre>
        </div>
      </div>
      
      <div>
        <h3>Document Requirements</h3>
        
        <table class="table">
          <thead>
            <tr>
              <th>Document</th>
              <th>Required</th>
              <th>Expiry Alerts</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Right to Work</td>
              <td><span class="badge badge-red">Mandatory</span></td>
              <td>30, 21, 14, 7, 0 days</td>
            </tr>
            <tr>
              <td>Photo ID</td>
              <td><span class="badge badge-red">Mandatory</span></td>
              <td>â€”</td>
            </tr>
            <tr>
              <td>CSCS Card</td>
              <td><span class="badge badge-red">Mandatory</span></td>
              <td>60, 30, 14, 7, 0 days</td>
            </tr>
            <tr>
              <td>CPCS/NPORS Tickets</td>
              <td><span class="badge badge-gold">If Required</span></td>
              <td>30, 14, 7 days</td>
            </tr>
          </tbody>
        </table>
        
        <h3 style="margin-top: 2rem;">Expiry Monitoring</h3>
        
        <div class="code-block">
          <div class="code-header">
            <span class="code-dot red"></span>
            <span class="code-dot yellow"></span>
            <span class="code-dot green"></span>
            <span class="code-title">cron/expiryAlerts.ts</span>
          </div>
          <pre><span class="comment">// Runs daily at 06:00 UTC</span>
<span class="keyword">async function</span> <span class="function">checkExpiringDocuments</span>() {
  <span class="keyword">const</span> thresholds = [<span class="string">30</span>, <span class="string">21</span>, <span class="string">14</span>, <span class="string">7</span>, <span class="string">0</span>];
  
  <span class="keyword">for</span> (<span class="keyword">const</span> days <span class="keyword">of</span> thresholds) {
    <span class="keyword">const</span> expiring = <span class="keyword">await</span> db.documents
      .<span class="function">findExpiring</span>(days);
    
    <span class="keyword">for</span> (<span class="keyword">const</span> doc <span class="keyword">of</span> expiring) {
      <span class="comment">// Alert Liam (dashboard + email)</span>
      <span class="keyword">await</span> <span class="function">notifyLabourManager</span>({
        type: <span class="string">'document_expiry'</span>,
        urgency: days === <span class="string">0</span> ? <span class="string">'critical'</span> 
               : days <= <span class="string">7</span> ? <span class="string">'high'</span> 
               : <span class="string">'medium'</span>,
        operative: doc.operative,
        document: doc
      });
      
      <span class="comment">// Alert operative via WhatsApp</span>
      <span class="keyword">await</span> <span class="function">sendWhatsApp</span>(
        doc.operative.phone,
        <span class="string">`âš ï¸ Your ${doc.type} expires in `</span> +
        <span class="string">`${days} days. Please upload a `</span> +
        <span class="string">`new copy to continue working.`</span>
      );
    }
  }
}</pre>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ===== 10: SEARCH ALGORITHM ===== -->
<section class="section dot-grid">
  <div class="container">
    <div class="section-label fade-up">
      <div class="label-line"></div>
      <span class="label">Search / 010</span>
    </div>
    
    <h2 class="fade-up">Labour <span class="text-cyan">Search</span></h2>
    
    <p class="fade-up">Intelligent matching based on role, location, rate, experience, and performance.</p>
    
    <div class="grid grid-2 fade-up" style="margin-top: 2rem; align-items: start;">
      <div>
        <h3>Search Priority (Liam-Defined)</h3>
        
        <table class="table">
          <thead>
            <tr>
              <th>#</th>
              <th>Filter</th>
              <th>Logic</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td><strong>Role/Trade</strong></td>
              <td>Primary filter â€” always required</td>
            </tr>
            <tr>
              <td>2</td>
              <td>Location</td>
              <td>Postcode + radius (miles)</td>
            </tr>
            <tr>
              <td>3</td>
              <td>Day Rate</td>
              <td>Min/max range</td>
            </tr>
            <tr>
              <td>4</td>
              <td>Experience</td>
              <td>Minimum years</td>
            </tr>
            <tr>
              <td>5</td>
              <td>Certifications</td>
              <td>Required tickets (CPCS, etc.)</td>
            </tr>
            <tr>
              <td>6</td>
              <td>Availability</td>
              <td>Status = available/verified</td>
            </tr>
            <tr>
              <td>7</td>
              <td>Rating</td>
              <td>Minimum avg rating</td>
            </tr>
          </tbody>
        </table>
        
        <div class="card" style="margin-top: 1.5rem; border-color: var(--color-cyan);">
          <h4 class="text-cyan">Exclusions</h4>
          <p>Currently working operatives are <strong>automatically excluded</strong> from search to prevent unnecessary messaging.</p>
        </div>
      </div>
      
      <div>
        <h3>Search Query</h3>
        
        <div class="code-block">
          <div class="code-header">
            <span class="code-dot red"></span>
            <span class="code-dot yellow"></span>
            <span class="code-dot green"></span>
            <span class="code-title">search.sql</span>
          </div>
          <pre><span class="keyword">SELECT</span> 
  o.*,
  <span class="comment">-- Distance calculation (Haversine)</span>
  <span class="function">earth_distance</span>(
    <span class="function">ll_to_earth</span>(o.lat, o.lng),
    <span class="function">ll_to_earth</span>($lat, $lng)
  ) / <span class="string">1609.34</span> <span class="keyword">AS</span> distance_miles
<span class="keyword">FROM</span> operatives o
<span class="keyword">WHERE</span> 
  <span class="comment">-- Trade (required)</span>
  o.trade_category_id = $tradeId
  
  <span class="comment">-- Status (available only)</span>
  <span class="keyword">AND</span> o.status <span class="keyword">IN</span> (<span class="string">'available'</span>, <span class="string">'verified'</span>)
  
  <span class="comment">-- Compliance (must be valid)</span>
  <span class="keyword">AND</span> o.rtw_verified = <span class="string">true</span>
  <span class="keyword">AND</span> o.rtw_expiry > <span class="function">CURRENT_DATE</span>
  <span class="keyword">AND</span> o.cscs_expiry > <span class="function">CURRENT_DATE</span>
  
  <span class="comment">-- Rate range</span>
  <span class="keyword">AND</span> o.day_rate <span class="keyword">BETWEEN</span> $rateMin <span class="keyword">AND</span> $rateMax
  
  <span class="comment">-- Experience</span>
  <span class="keyword">AND</span> o.years_experience >= $minExp
  
  <span class="comment">-- Rating</span>
  <span class="keyword">AND</span> (o.avg_rating >= $minRating 
       <span class="keyword">OR</span> o.avg_rating <span class="keyword">IS NULL</span>)
  
  <span class="comment">-- Location radius</span>
  <span class="keyword">AND</span> <span class="function">earth_distance</span>(
    <span class="function">ll_to_earth</span>(o.lat, o.lng),
    <span class="function">ll_to_earth</span>($lat, $lng)
  ) <= $radiusMiles * <span class="string">1609.34</span>
  
  <span class="comment">-- Certifications (if required)</span>
  <span class="keyword">AND</span> ($certs <span class="keyword">IS NULL OR</span> 
       o.skills @> $certs)

<span class="keyword">ORDER BY</span> 
  o.avg_rating <span class="keyword">DESC NULLS LAST</span>,
  distance_miles <span class="keyword">ASC</span>
<span class="keyword">LIMIT</span> <span class="string">50</span>;</pre>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ===== 11: SECURITY ===== -->
<section class="section">
  <div class="container">
    <div class="section-label fade-up">
      <div class="label-line"></div>
      <span class="label">Security / 011</span>
    </div>
    
    <h2 class="fade-up">Security & <span class="text-red">Data Protection</span></h2>
    
    <div class="grid grid-2 fade-up" style="margin-top: 2rem;">
      <div>
        <h3>Data Protection</h3>
        <table class="table">
          <tbody>
            <tr>
              <td><strong>UK Data Residency</strong></td>
              <td>Supabase eu-west-2 (London)</td>
            </tr>
            <tr>
              <td><strong>Encryption at Rest</strong></td>
              <td>AES-256</td>
            </tr>
            <tr>
              <td><strong>Encryption in Transit</strong></td>
              <td>TLS 1.3</td>
            </tr>
            <tr>
              <td><strong>GDPR Compliant</strong></td>
              <td>Right to access, rectification, deletion</td>
            </tr>
            <tr>
              <td><strong>Database Download</strong></td>
              <td>Blocked â€” no bulk export allowed</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div>
        <h3>Access Controls</h3>
        <table class="table">
          <tbody>
            <tr>
              <td><strong>Authentication</strong></td>
              <td>Supabase Auth (email/password)</td>
            </tr>
            <tr>
              <td><strong>Authorization</strong></td>
              <td>Role-based (Director, Labour Manager, Site Manager)</td>
            </tr>
            <tr>
              <td><strong>Row-Level Security</strong></td>
              <td>PostgreSQL RLS policies</td>
            </tr>
            <tr>
              <td><strong>MFA</strong></td>
              <td>Optional 2FA for all users</td>
            </tr>
            <tr>
              <td><strong>Audit Trail</strong></td>
              <td>Every action logged with who/when/what</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <h3 class="fade-up" style="margin-top: 2rem;">Row-Level Security Example</h3>
    
    <div class="code-block fade-up">
      <div class="code-header">
        <span class="code-dot red"></span>
        <span class="code-dot yellow"></span>
        <span class="code-dot green"></span>
        <span class="code-title">rls_policies.sql</span>
      </div>
      <pre><span class="comment">-- Enable RLS on operatives table</span>
<span class="keyword">ALTER TABLE</span> operatives <span class="keyword">ENABLE ROW LEVEL SECURITY</span>;

<span class="comment">-- Users can only see operatives in their organization</span>
<span class="keyword">CREATE POLICY</span> <span class="string">"Users see own org operatives"</span>
<span class="keyword">ON</span> operatives <span class="keyword">FOR SELECT</span>
<span class="keyword">USING</span> (
  organization_id = (
    <span class="keyword">SELECT</span> organization_id 
    <span class="keyword">FROM</span> users 
    <span class="keyword">WHERE</span> id = <span class="function">auth.uid</span>()
  )
);

<span class="comment">-- Only Labour Managers can update operatives</span>
<span class="keyword">CREATE POLICY</span> <span class="string">"Labour managers update operatives"</span>
<span class="keyword">ON</span> operatives <span class="keyword">FOR UPDATE</span>
<span class="keyword">USING</span> (
  organization_id = (
    <span class="keyword">SELECT</span> organization_id 
    <span class="keyword">FROM</span> users 
    <span class="keyword">WHERE</span> id = <span class="function">auth.uid</span>()
    <span class="keyword">AND</span> role <span class="keyword">IN</span> (<span class="string">'labour_manager'</span>, <span class="string">'director'</span>, <span class="string">'admin'</span>)
  )
);</pre>
    </div>
  </div>
</section>

<!-- ===== 12: TIMELINE ===== -->
<section class="section line-grid">
  <div class="container">
    <div class="section-label fade-up">
      <div class="label-line"></div>
      <span class="label">Timeline / 012</span>
    </div>
    
    <h2 class="fade-up">Implementation <span class="text-cyan">Timeline</span></h2>
    
    <p class="fade-up">12-16 weeks from approval to go-live.</p>
    
    <div class="grid grid-2 fade-up" style="margin-top: 2rem; align-items: start;">
      <div class="timeline">
        <div class="timeline-item">
          <div class="timeline-marker"></div>
          <div class="timeline-content">
            <span class="timeline-phase">Phase 1</span>
            <h4>Discovery & Foundation</h4>
            <p>Requirements confirmed, database schema deployed, auth setup, core UI scaffolding.</p>
            <span class="timeline-duration">2 Weeks</span>
          </div>
        </div>
        
        <div class="timeline-item">
          <div class="timeline-marker"></div>
          <div class="timeline-content">
            <span class="timeline-phase">Phase 2</span>
            <h4>Core Build</h4>
            <p>Operatives CRUD, search, sites, allocations, documents, compliance tracking, Liam dashboard.</p>
            <span class="timeline-duration">6 Weeks</span>
          </div>
        </div>
        
        <div class="timeline-item">
          <div class="timeline-marker"></div>
          <div class="timeline-content">
            <span class="timeline-phase">Phase 3</span>
            <h4>Communications</h4>
            <p>WhatsApp integration, Sophie AI agent, Site Manager bot, templates, NCR flow.</p>
            <span class="timeline-duration">3 Weeks</span>
          </div>
        </div>
        
        <div class="timeline-item">
          <div class="timeline-marker"></div>
          <div class="timeline-content">
            <span class="timeline-phase">Phase 4</span>
            <h4>Polish & Deploy</h4>
            <p>Testing, training, data migration, go-live, 2-week hypercare period.</p>
            <span class="timeline-duration">3 Weeks</span>
          </div>
        </div>
      </div>
      
      <div>
        <h3>Deliverables Per Phase</h3>
        
        <div class="card" style="margin-bottom: 1rem;">
          <h4 class="text-cyan">Phase 1 Output</h4>
          <ul style="color: var(--color-text-secondary); font-size: 0.875rem; padding-left: 1.25rem;">
            <li>Database live in Supabase (London)</li>
            <li>Auth working with test users</li>
            <li>Basic dashboard shell deployed</li>
            <li>Trade categories seeded</li>
          </ul>
        </div>
        
        <div class="card" style="margin-bottom: 1rem;">
          <h4 class="text-gold">Phase 2 Output</h4>
          <ul style="color: var(--color-text-secondary); font-size: 0.875rem; padding-left: 1.25rem;">
            <li>Full operative management</li>
            <li>Document upload & tracking</li>
            <li>Expiry alerts working</li>
            <li>Allocation workflow</li>
            <li>Performance reviews & NCRs</li>
          </ul>
        </div>
        
        <div class="card" style="margin-bottom: 1rem;">
          <h4 class="text-green">Phase 3 Output</h4>
          <ul style="color: var(--color-text-secondary); font-size: 0.875rem; padding-left: 1.25rem;">
            <li>WhatsApp Business connected</li>
            <li>Sophie qualifying candidates</li>
            <li>Arrival confirmations working</li>
            <li>NCR via WhatsApp</li>
            <li>Shift confirmations</li>
          </ul>
        </div>
        
        <div class="card">
          <h4 class="text-purple">Phase 4 Output</h4>
          <ul style="color: var(--color-text-secondary); font-size: 0.875rem; padding-left: 1.25rem;">
            <li>Full UAT complete</li>
            <li>Liam trained</li>
            <li>Historical data migrated</li>
            <li>Production go-live</li>
            <li>2 weeks hypercare support</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ===== 13: CTA ===== -->
<section class="section cta-section dot-grid">
  <div class="corner tl"></div>
  <div class="corner br"></div>
  
  <div class="container">
    <div class="section-label fade-up" style="justify-content: center;">
      <div class="label-line"></div>
      <span class="label">Next Steps / 013</span>
    </div>
    
    <h2 class="fade-up" style="font-size: clamp(2rem, 5vw, 3.5rem);">
      Ready to <span class="text-gold">Build</span>?
    </h2>
    
    <p class="fade-up" style="max-width: 600px; margin: 0 auto 2rem;">
      Cold Lava is ready to begin immediately upon board approval. All architecture has been designed, database schemas are ready, and the team is standing by.
    </p>
    
    <div class="stats-grid fade-up" style="max-width: 800px; margin: 2rem auto;">
      <div class="stat-item">
        <div class="stat-number">12-16</div>
        <div class="stat-label">Weeks to Launch</div>
      </div>
      <div class="stat-item">
        <div class="stat-number">Â£55k</div>
        <div class="stat-label">Build Investment</div>
      </div>
      <div class="stat-item">
        <div class="stat-number">Â£120k</div>
        <div class="stat-label">Est. Annual Saving</div>
      </div>
      <div class="stat-item">
        <div class="stat-number">&lt;12mo</div>
        <div class="stat-label">ROI Payback</div>
      </div>
    </div>
    
    <div class="fade-up" style="margin-top: 3rem;">
      <a href="mailto:oliver@coldlava.ai" class="btn btn-primary">Get Started</a>
    </div>
    
    <div class="fade-up" style="margin-top: 4rem; color: var(--color-text-muted); font-size: 0.875rem;">
      <p>oliver@coldlava.ai â€¢ jacob@coldlava.ai</p>
      <p class="mono" style="margin-top: 1rem;">Â© 2026 Cold Lava AI Ltd</p>
    </div>
  </div>
</section>

<div class="grain"></div>

<!-- GSAP -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>

<script>
  gsap.registerPlugin(ScrollTrigger);
  
  // Fade up animations
  gsap.utils.toArray('.fade-up').forEach(el => {
    gsap.to(el, {
      opacity: 1,
      y: 0,
      duration: 1,
      ease: 'power3.out',
      scrollTrigger: {
        trigger: el,
        start: 'top 85%',
        toggleActions: 'play none none none'
      }
    });
  });
</script>

</body>
</html>
